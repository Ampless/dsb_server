import 'dart:io';

import 'package:dsb_server/dsb_server.dart';
import 'package:dsbuntis/dsbuntis.dart';
import 'package:shelf/shelf_io.dart';
import 'package:test/test.dart';

const coolJson =
    '[{"Id":"c9fb6314-cda8-4c4c-93fe-328580dc3502","Date":"31.03.2020 17:18","Title":"Homeschooling-Stundenplan","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"c9fb6314-cda8-4c4c-93fe-328580dc3502_556","Date":"31.03.2020 17:18","Title":"Homeschooling-Stundenplan","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/c9fb6314-cda8-4c4c-93fe-328580dc3502/c9fb6314-cda8-4c4c-93fe-328580dc3502_000.jpg","Tags":"","ConType":4,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/c9fb6314-cda8-4c4c-93fe-328580dc3502/c9fb6314-cda8-4c4c-93fe-328580dc3502_000.jpg"}],"Preview":""},{"Id":"1659d4e3-c8be-45a4-8a3f-01f01c8495ed","Date":"31.03.2020 17:18","Title":"Schulchat-Knigge_Digitale-Schule","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"1659d4e3-c8be-45a4-8a3f-01f01c8495ed_1668","Date":"31.03.2020 17:18","Title":"Schulchat-Knigge_Digitale-Schule","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_000.jpg","Tags":"","ConType":4,"Prio":0,"Index":0,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_000.jpg"},{"Id":"1659d4e3-c8be-45a4-8a3f-01f01c8495ed_1669","Date":"31.03.2020 17:18","Title":"Schulchat-Knigge_Digitale-Schule","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_001.jpg","Tags":"","ConType":4,"Prio":0,"Index":1,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_001.jpg"},{"Id":"1659d4e3-c8be-45a4-8a3f-01f01c8495ed_1670","Date":"31.03.2020 17:18","Title":"Schulchat-Knigge_Digitale-Schule","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_002.jpg","Tags":"","ConType":4,"Prio":0,"Index":1670,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/1659d4e3-c8be-45a4-8a3f-01f01c8495ed/1659d4e3-c8be-45a4-8a3f-01f01c8495ed_002.jpg"}],"Preview":""},{"Id":"b3a6e8fa-f795-4367-8193-6057213d6c71","Date":"31.03.2020 17:18","Title":"Speiseplan_Dienstag","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"b3a6e8fa-f795-4367-8193-6057213d6c71_556","Date":"31.03.2020 17:18","Title":"Speiseplan_Dienstag","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/b3a6e8fa-f795-4367-8193-6057213d6c71/b3a6e8fa-f795-4367-8193-6057213d6c71_000.jpg","Tags":"","ConType":4,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/b3a6e8fa-f795-4367-8193-6057213d6c71/b3a6e8fa-f795-4367-8193-6057213d6c71_000.jpg"}],"Preview":""},{"Id":"3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41","Date":"31.03.2020 17:18","Title":"Speiseplan_Mittwoch","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41_556","Date":"31.03.2020 17:18","Title":"Speiseplan_Mittwoch","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41/3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41_000.jpg","Tags":"","ConType":4,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41/3fcb28a0-7ca9-43f9-a3ab-7aa2acafeb41_000.jpg"}],"Preview":""},{"Id":"f77ee95b-2acf-4fb0-86d7-f561ca4e5ad4","Date":"31.03.2020 17:25","Title":"DSBplan-Plan","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"f77ee95b-2acf-4fb0-86d7-f561ca4e5ad4_556","Date":"31.03.2020 17:25","Title":"DSBplan-Plan","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/f77ee95b-2acf-4fb0-86d7-f561ca4e5ad4/DSBplan-Plan.html","Tags":"","ConType":6,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/f77ee95b-2acf-4fb0-86d7-f561ca4e5ad4/preview.png"}],"Preview":""},{"Id":"67b3035c-51ff-4106-a2ec-b50f8680e0c4","Date":"31.03.2020 17:33","Title":"Vertretungen-heute","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"67b3035c-51ff-4106-a2ec-b50f8680e0c4_556","Date":"31.03.2020 17:33","Title":"Vertretungen-heute","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/67b3035c-51ff-4106-a2ec-b50f8680e0c4/Vertretungen-heute.htm","Tags":"","ConType":6,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/67b3035c-51ff-4106-a2ec-b50f8680e0c4/preview.png"}],"Preview":""},{"Id":"4f301632-7422-4186-96a2-2b7911f54bc5","Date":"31.03.2020 17:34","Title":"Vertretungen-Woche","Detail":"","Tags":"","ConType":2,"Prio":0,"Index":0,"Childs":[{"Id":"4f301632-7422-4186-96a2-2b7911f54bc5_556","Date":"31.03.2020 17:34","Title":"Vertretungen-Woche","Detail":"https://light.dsbcontrol.de/DSBlightWebsite/Data/13ccccbb-e6a8-466a-addc-00bba830c6cf/4f301632-7422-4186-96a2-2b7911f54bc5/Vertretungen-Woche.htm","Tags":"","ConType":6,"Prio":0,"Index":556,"Childs":[],"Preview":"13ccccbb-e6a8-466a-addc-00bba830c6cf/4f301632-7422-4186-96a2-2b7911f54bc5/preview.png"}],"Preview":""}]';
const token = '13ccccbb-e6a8-466a-addc-00bba830c6cf';

void main() => serve(
      dsbHandler(
          generateAuthid: (_, __, ___, ____, _____) => token,
          getContent: (path, authid) =>
              path == 'dsbtimetables' && authid == token ? coolJson : null),
      InternetAddress.loopbackIPv6,
      0,
    ).then((server) {
      test('getAllSubs', () async {
        await getAllSubs('usar', 'parswoad',
            endpoint:
                'http://[${InternetAddress.loopbackIPv6.address}]:${server.port}');
      });
    });
